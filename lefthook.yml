# Lefthook configuration for Headscale Docker setup
# Install: brew install lefthook (macOS) or npm install -g lefthook
# Setup: lefthook install
#
# All hook scripts are in scripts/lefthook/ directory

pre-commit:
  parallel: true

  commands:
    # Check for exposed secrets
    secrets-scan:
      tags: security
      run: bash scripts/lefthook/secrets-scan.sh

    # Ensure .env is not committed
    env-check:
      tags: security
      glob: ".env"
      run: bash scripts/lefthook/env-check.sh

    # Check that headplane/config.yaml is not committed
    headplane-config-check:
      tags: security
      glob: "headplane/config.yaml"
      run: bash scripts/lefthook/headplane-config-check.sh

    # Check for .DS_Store files
    ds-store-check:
      tags: cleanup
      glob: ".DS_Store"
      run: bash scripts/lefthook/ds-store-check.sh

    # Verify example files exist for sensitive configs
    example-files-check:
      tags: documentation
      run: bash scripts/lefthook/example-files-check.sh

    # YAML syntax validation
    yaml-lint:
      tags: validation
      glob: "*.{yml,yaml}"
      run: bash scripts/lefthook/yaml-lint.sh

pre-push:
  parallel: true

  commands:
    # Final security check before push
    final-secrets-scan:
      tags: security
      run: bash scripts/lefthook/final-secrets-scan.sh

    # Verify .gitignore is comprehensive
    gitignore-check:
      tags: security
      run: bash scripts/lefthook/gitignore-check.sh

    # Check for large files
    large-files-check:
      tags: optimization
      run: bash scripts/lefthook/large-files-check.sh

commit-msg:
  commands:
    # Validate commit message format
    commit-msg-format:
      tags: quality
      run: bash scripts/lefthook/commit-msg-format.sh {1}

# Skip hooks for specific commands if needed
skip_output:
  - meta
  - summary

colors: true
